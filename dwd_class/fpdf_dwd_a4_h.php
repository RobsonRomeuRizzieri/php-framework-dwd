<?phpclass fpdf_dwd_a4_h extends fpdf{	//Divisor de cada Linha na descrição do cabecalho é ;wd;  public $str_rua;  public $str_cidade;  public $str_estado;  public $str_email;  public $str_telefone;  public $str_CEP;  public $str_bairro;  public $str_url_pagina;  public $str_empresa;  public $str_titulo;	public $str_lookup_dinamico;	public $str_lookup_fixo;	private $arr_lookup_dinamico;	private $arr_lookup_fixo;  //Defini onde esta a imagem  public $str_imagem_url;  public $int_imagem_topo;  public $int_imagem_esquerdo;  public $int_imagem_largura;  public $int_imagem_altura;  public $strSQL;  private $str_imagem_wd_url;  private $int_imagem_wd_topo;  private $int_imagem_wd_esquerdo;  private $int_imagem_wd_largura;  private $int_imagem_wd_altura;  public $str_campo;  public $str_campo_tipo;  public $str_campo_valor;  public $str_campo_descricao;  public $str_campo_margem_esquerda;  public $str_filtro;  public $str_entidade;	public function __construct(){	  parent::__construct();	  $this->str_imagem_url = "../wd_imagem/logo_tipo2.jpg";	  $this->str_titulo = "Titulo Relatório Work Dynamics";    $this->str_campo_margem_esquerda = "P;wd;mm;wd;A4;wd;10;wd;25;wd;80;wd;140;wd;190;wd;205;wd;220";		$this->int_imagem_topo = 10;		$this->int_imagem_esquerdo = 10;		$this->int_imagem_largura = 93;		$this->int_imagem_altura = 18;	}	function Header()	{    $this->Ln(5);    $this->Image($this->str_imagem_url,$this->int_imagem_esquerdo,$this->int_imagem_topo,$this->int_imagem_largura,$this->int_imagem_altura);		$this->SetFont('Arial','B',12);	  $this->Cell(0,0,$this->str_titulo,0,0,'R');		$this->SetFont('Arial','',5);	  $this->Ln(2);	  $this->SetX($this->int_imagem_largura + 20);	  $this->Cell(0,5,'Rua: '.$this->str_rua.' - '.$this->str_bairro.' - '.$this->str_CEP.' - '.$this->str_cidade.' - '.$this->str_estado,0,0,'R');	  $this->Ln();	  $this->SetX($this->int_imagem_largura + 20);	  $this->Cell(0,0,'E-mail: '.$this->str_email,0,0,'R');	  $this->Ln();	  $this->SetX($this->int_imagem_largura + 20);	  $this->Cell(0,5,'Telefone: '.$this->str_telefone,0,0,'R');	  $this->Ln();	  $this->SetX($this->int_imagem_largura + 20);	  $this->Cell(0,0,'Página WEB: '.$this->str_url_pagina,0,0,'R');	  //Line break	  $this->Ln(2);		//Títulos das colunas		$this->SetFont('Arial', 'B', 10);		//Define a cor RGB do fundo da celula		$this->SetFillColor(178,178,178);		$arr_campo_descricao = explode(";wd;",$this->str_campo_descricao);		$arr_campo_margem_esquerda = explode(";wd;",$this->str_campo_margem_esquerda);    //Define se a pagina é na horizontal ou vertical  	$this->DefOrientation = $arr_campo_margem_esquerda[0];  	//DEfine as medidas do arquivo  	$this->medidas = $arr_campo_margem_esquerda[1];  	//Define tipo do arquivo		$this->intPaginaLarguraAltura = $arr_campo_margem_esquerda[2];    $cont_desc = count($arr_campo_descricao);    $int_maregem = 0;    for ($i = 0; $i < $cont_desc; $i++){    	if ($this->str_campo_margem_esquerda != ""){	    	  $int_margem = $arr_campo_margem_esquerda[$i + 3];    	}	else{			  $int_margem = $int_margem + 30;    	}   	  if ($i == 0){  			$int_margem = 10;   	  }			//Faz a célula ser preenchida. Isso é feito setando 1 após a expressao de alinhamento			$this->SetX($int_margem);			$this->Cell(0,6, $arr_campo_descricao[$i],0,0,'L',1);		}    $this->Ln();	}	//Rodapé do Relatório	function Footer()	{	  $usuarioNome = $_SESSION["usuario_login"];	  //Position at 1.5 cm from bottom	  $this->SetY(-22);	  //Arial italic 8	  $this->SetFont('Arial','I',7);	  //Page number    $this->Line(10,275,200,275);		$empresaNome = $_SESSION["filial_nome"];    //Ajusta a fonte    $this->SetFont('Arial','',9);		$this->str_imagem_wd_url = "../wd_imagem/logo_tipo.jpg";		$this->int_imagem_wd_topo = 276;		$this->int_imagem_wd_esquerdo = 10;		$this->int_imagem_wd_largura = 17;		$this->int_imagem_wd_altura = 10;    $this->Image($this->str_imagem_wd_url,$this->int_imagem_wd_esquerdo,$this->int_imagem_wd_topo,$this->int_imagem_wd_largura,$this->int_imagem_wd_altura);    //Titulo do relatório   	$this->SetX(28);		$this->Cell(0,6,"Unidade: ".$empresaNome);		$this->Cell(0,6,'Pagina: '.$this->PageNo(),0,0,'R');	  $this->Ln();   	$this->SetX(28);  	$this->Cell(0,3,'Emitido por '.$usuarioNome.' em: '.date('d/m/Y', mktime())." - ".date('H:m'));		$this->SetFont('Arial','I',5);   	$this->SetX(90);    $this->Write(8,'Powered By Work Dynamics','http://www.workdynamics.com.br');	}  function criar(){		$this->SetCreator('work Dynamics');		$this->SetAuthor($usuarioNome . " - " . $empresaNome . " - Work Dynamics" );		$this->SetTitle($this->str_titulo);		$this->SetSubject('Relatório gerado automaticamente pelo sistema');		$this->AliasNbPages();		$this->AddPage();	  $obj_acesso = new wd_db_entidade($_SESSION["banco_tipo"],$_SESSION["servidor"],$_SESSION["banco_nome"],$_SESSION["banco_usuario"],$_SESSION["banco_senha"],$_SESSION["banco_porta"],$_SESSION["exibir_sql"],$this->str_entidade,$_SESSION["sql_maiusculo"],$_SESSION["sql_padrao"],$_SESSION["sql_aspa_crase"]);    $obj_acesso->str_campo = $this->str_campo;    $obj_acesso->str_campo_tipo = $this->str_campo_tipo;    $obj_acesso->str_filtro = $this->str_filtro;    if ($this->strSQL != ""){    	$this->strSQL = str_replace("wdrrr","'",$this->strSQL);      $matriz = $obj_acesso->consultar($this->strSQL);		}else{	    $matriz = $obj_acesso->consultar();	  }		$bolMudaCor = true;    $this->Ln(-6);		//Monta as linhas com os dados da query		$this->SetFont('Arial','',10);    $arr_campo_rel = explode(";wd;",$this->str_campo);    $arr_campo_tipo_rel = explode(";wd;",$this->str_campo_tipo);		$arr_campo_margem_esquerda = explode(";wd;",$this->str_campo_margem_esquerda);    $cont_campo = count($arr_campo_rel);		//Definição dos campos de lookup		$arr_lookup_des = explode(";wd;",$this->str_lookup_dinamico);		$cont_arr_lookup_des = count($arr_lookup_des);		//Recria array de lookup dinamaico com o indice do tipo string mesmo é chave estrangeira.		for($j = 0; $j < $cont_arr_lookup_des; $j++){		  $arr_lookup_des_item = explode("//",$arr_lookup_des[$j]);  	  $this->arr_lookup_dinamico[$arr_lookup_des_item[3]] = $arr_lookup_des_item[0]."//".$arr_lookup_des_item[1]."//".$arr_lookup_des_item[2];		}		if ($this->str_lookup_fixo != ""){			$this->arr_lookup_fixo = explode(";wd;",$this->str_lookup_fixo);			$cont_arr_fixo = count($this->arr_lookup_fixo);			for ($jj = 0; $jj < $cont_arr_fixo; $jj++){			  $arr_temp_fixo = explode("//",$this->arr_lookup_fixo[$jj]);				$arr_temp_item_fixo[$arr_temp_fixo[0]][$arr_temp_fixo[1]] = $arr_temp_fixo[2];			}    }    $cont_reg = 0;    $int_linha_reg = 35;	  if (!empty($matriz)){		  foreach($matriz as $row){			  $this->ln();				$int_margem = 0;			  if ($bolMudaCor){				    $intVermelho = 255;				    $intVerde = 255;				    $intAzul = 255;				    $bolMudaCor = false;				  }else{				    $intVermelho = 225;				    $intVerde = 225;				    $intAzul = 225;				    $bolMudaCor = true;				  }				  $this->SetFillColor($intVermelho,$intVerde,$intAzul);    		$arr_campo_descricao = explode(";wd;",$this->str_campo_descricao);		    $arr_campo_margem_esquerda = explode(";wd;",$this->str_campo_margem_esquerda);        $int_maregem = 0;        for ($i = 0; $i < $cont_campo; $i++){		    	if ($this->str_campo_margem_esquerda != ""){  		    	  $int_margem = $arr_campo_margem_esquerda[$i + 3];		    	}	else{					  $int_margem = $int_margem + 30;		    	}		   	  if ($i == 0){		  			$int_margem = 10;		   	  }					//Faz a célula ser preenchida. Isso é feito setando 1 após a expressao de alinhamento          if ($_SESSION["sql_maiusculo"]){            $str_campo_rel = strtoupper($arr_campo_rel[$i]);  			  }else{  			  	$str_campo_rel = strtolower($arr_campo_rel[$i]);					}					$str_valor =  $row[$str_campo_rel];          //DEfinição do lookup fixo          if ($arr_temp_item_fixo[$arr_campo_rel[$i]][$str_valor] != ""){            $str_valor = 	$arr_temp_item_fixo[$arr_campo_rel[$i]][$str_valor];          }					//Definição dos campos de lookup Dinamico					$arr_lookup_des = explode(";wd;",$this->str_lookup_dinamico);					$cont_arr_lookup_des = count($arr_lookup_des);					//Recria array de lookup dinamaico com o indice do tipo string mesmo é chave estrangeira.					for($j = 0; $j < $cont_arr_lookup_des; $j++){					  $arr_lookup_des_item = explode("//",$arr_lookup_des[$j]);			  	  $this->arr_lookup_dinamico[$arr_lookup_des_item[3]] = $arr_lookup_des_item[0]."//".$arr_lookup_des_item[1]."//".$arr_lookup_des_item[2];					}          if ($this->arr_lookup_dinamico[$arr_campo_rel[$i]] != ""){					  $str_campo_temp = $obj_acesso->str_campo;						$str_campo_tipo_temp = $obj_acesso->str_campo_tipo;						$str_campo_valor_temp = $obj_acesso->str_campo_valor;						$str_entidade_temp = $obj_acesso->str_entidade;						$str_filtro_temp = $obj_acesso->str_filtro;            if ($str_valor != ""){							$arr_lookup_dinamico = explode("//",$this->arr_lookup_dinamico[$arr_campo_rel[$i]]);							$obj_acesso->str_campo = $arr_lookup_dinamico[2];							$obj_acesso->str_campo_tipo = "string";							$obj_acesso->str_filtro = "sem_aspas//and//".$arr_lookup_dinamico[1]."//=//".$str_valor;							$obj_acesso->str_entidade = $arr_lookup_dinamico[0];							$matriz_lookup = $obj_acesso->consultar();							if (!empty($matriz_lookup)){							  foreach($matriz_lookup as $row_lookup){									if ($_SESSION["sql_maiusculo"]){		   					    $str_valor =  $row_lookup[strtoupper($arr_lookup_dinamico[2])];		              }else{		   					    $str_valor =  $row_lookup[strtolower($arr_lookup_dinamico[2])];		              }								}							}						}						$obj_acesso->str_filtro = $str_filtro_temp;            $obj_acesso->str_campo = $str_campo_temp;						$obj_acesso->str_campo_tipo = $str_campo_tipo_temp;						$obj_acesso->str_campo_valor = $str_campo_valor_temp;						$obj_acesso->str_entidade = $str_entidade_temp;					}          if (($str_valor == 1) && ($arr_campo_tipo_rel[$i] == "checkbox")){					  $str_valor = "Sim";					}else if (($str_valor == 0) && ($arr_campo_tipo_rel[$i] == "checkbox")){					  $str_valor = "Não";					}          $str_valor = strip_tags($str_valor);					$this->SetX($int_margem);					$this->Cell(0,5,$str_valor,0,0,'L',1);				}				$cont_reg++;		  }	  }		$this->SetFont('Arial', 'B', 8);		$this->ln();		$this->Cell(0,6, 'Total de registros listados: ' . $cont_reg,'T');		//Gera o PDF		$this->Output();  }}?>